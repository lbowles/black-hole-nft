<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BlackHole SVG</title>
  </head>

  <body>
    <div id="canvasContainer"></div>
    <script>
      const PIXELS_PER_SIDE = 28
      const PIXEL_SIZE = 20
      const CANVAS_SIZE = PIXELS_PER_SIDE * PIXEL_SIZE
      let BASE_HUE = 15

      function getPixelSVG(tokenId, pixelClass, x, y) {
        const backgroundColors = [
          "#140E0E",
          "#160F0D",
          "#17120E",
          "#181214",
          "#18130F",
          "#181310",
          "#181410",
          "#1A1210",
          "#1A1511",
          "#1B1310",
          "#1B1517",
          "#282221",
        ]

        const baseSaturation = 90
        const lightnesses = [20, 55, 80]
        const hueIncrements = 20

        const blackHoleColors = [
          "black",
          `hsl(${BASE_HUE + hueIncrements}, ${baseSaturation}%, ${lightnesses[2]}%)`,
          `hsl(${BASE_HUE}, ${baseSaturation}%, ${lightnesses[1]}%)`,
          `hsl(${BASE_HUE - hueIncrements}, ${baseSaturation}%, ${lightnesses[0]}%)`,
        ]

        const perimiterColors = ["#852C27", "#741D27", "#8F5359", "#D1652C"]
        let fillColor = ""
        const randomIndex = Math.floor(Math.random() * 200)

        if (pixelClass === 0) {
          // Background + small chance of dim star
          fillColor = randomIndex <= 10 ? "#504940" : backgroundColors[randomIndex % backgroundColors.length]
        } else if (pixelClass === 1) {
          fillColor = "black"
        } else if (pixelClass > 1 && pixelClass <= 6) {
          // Black hole
          fillColor = blackHoleColors[pixelClass - 1]
        } else if (pixelClass === 7) {
          // Perimiter
          if (randomIndex < 20) {
            fillColor = perimiterColors[randomIndex % perimiterColors.length]
          } else {
            return ""
          }
        }

        return `<rect x="${x * PIXEL_SIZE}" y="${
          y * PIXEL_SIZE
        }" width="${PIXEL_SIZE}" height="${PIXEL_SIZE}" fill="${fillColor}"/>`
        // <text x="${x * PIXEL_SIZE + PIXEL_SIZE / 2}" y="${y * PIXEL_SIZE + PIXEL_SIZE / 2}"
        // text-anchor="middle" dominant-baseline="middle" fill="white" font-size="10" font-family="sans-serif">${pixelClass}</text>
        // `
      }

      // Javascript
      function createQuarterCanvas(size) {
        let pixelsSVG = ""
        const renderEndIndex = PIXELS_PER_SIDE / 2
        const renderStartIndex = renderEndIndex - size - 5
        const tokenId = 1
        for (let i = renderStartIndex; i < renderEndIndex; i++) {
          for (let j = renderStartIndex; j < renderEndIndex; j++) {
            const x = j - PIXELS_PER_SIDE / 2
            const y = i - PIXELS_PER_SIDE / 2
            const distance = Math.floor(Math.sqrt(x * x + y * y))

            if (distance <= size) {
              pixelsSVG = pixelsSVG.concat(getPixelSVG(tokenId, 1, j, i))
            } else if (distance <= size + 1) {
              pixelsSVG = pixelsSVG.concat(getPixelSVG(tokenId, 2, j, i))
            } else if (distance <= size + 2) {
              pixelsSVG = pixelsSVG.concat(getPixelSVG(tokenId, 3, j, i))
            } else if (distance <= size + 3) {
              pixelsSVG = pixelsSVG.concat(getPixelSVG(tokenId, 4, j, i))
            } else if (distance <= size + 4) {
              // pixelsSVG = pixelsSVG.concat(getPixelSVG(tokenId, 5, j, i))
            } else if (distance <= size + 5) {
              // pixelsSVG = pixelsSVG.concat(getPixelSVG(tokenId, 7, j, i))
            }
          }
        }

        return pixelsSVG
      }

      function createSVG(quarterCanvas) {
        let svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${CANVAS_SIZE} ${CANVAS_SIZE}" width="${CANVAS_SIZE}" height="${CANVAS_SIZE}">`

        // Black background
        // svg += `<rect x="0" y="0" width="${CANVAS_SIZE}" height="${CANVAS_SIZE}" fill="#000000"/>`

        // Noise
        // for (let i = 0; i < 40; i++) {
        //   const x = Math.floor(Math.random() * PIXELS_PER_SIDE)
        //   const y = Math.floor(Math.random() * PIXELS_PER_SIDE)
        //   svg = svg.concat(getPixelSVG(1, 0, x, y))
        // }

        const id = `base${BASE_HUE}`

        // Quarter black hole
        let g = `<g id="${id}">`
        g += quarterCanvas
        g += `</g>`
        svg += g

        // Repetitions
        svg += `<use href="#${id}" transform="scale(-1,1),translate(-${CANVAS_SIZE},0)" />`
        svg += `<use href="#${id}" transform="scale(1,-1),translate(0,-${CANVAS_SIZE})" />`
        svg += `<use href="#${id}" transform="scale(-1,-1),translate(-${CANVAS_SIZE},-${CANVAS_SIZE})" />`

        svg += `</svg>`
        return svg
      }

      const hues = [15, 20, 25, 30, 35, 250]

      for (let i = 0; i < 6; i++) {
        const level = i

        BASE_HUE = hues[level]

        console.log(BASE_HUE)

        const holeSize = PIXELS_PER_SIDE / 2 - (10 - level)

        const canvas = document.createElement("div")
        canvas.innerHTML = createSVG(createQuarterCanvas(holeSize))
        document.getElementById("canvasContainer").appendChild(canvas)
      }
    </script>
  </body>
</html>
